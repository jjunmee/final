<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.ContentMapper">
	<insert id="insert" parameterType="content">
		insert into content values(#{content_num},#{content_name},#{orgsrc},#{savesrc},#{content_summary},
		#{trailer_orgsrc},#{trailer_savesrc},#{content_size},#{trailer_size},#{content_post1},
		#{content_post2},#{release_date},#{watch_age},now(),#{series_num})
	</insert>
	<update id="update" parameterType="content">
		update content 
		set 
		<if test="savesrc != null">
			orgsrc=#{orgsrc},savesrc=#{savesrc},
			content_size=#{content_size},
		</if>
		<if test="trailer_savesrc != null">
			trailer_orgsrc=#{trailer_orgsrc},trailer_savesrc=#{trailer_savesrc},
			trailer_size=#{trailer_size},
		</if>
		<if test="content_post1 != null">
			content_post1=#{content_post1},
		</if>
		<if test="content_post2 != null">
			content_post2=#{content_post2},
		</if>
		<if test="series_num != 0">
			series_num=#{series_num},
		</if>
		content_name=#{content_name},content_summary=#{content_summary},
		release_date=#{release_date},watch_age=#{watch_age}
		where content_num=#{content_num}
	</update>
	<update id="deleteSeries" parameterType="int">
		update content set series_num=0 where series_num=#{value}
	</update>
	<delete id="delete" parameterType="int">
		delete from content where content_num=#{value}
	</delete>
	<select id="list" resultType="content" parameterType="hashmap">
		select *
		from content
		<if test="keyword != null">
			where content_name like CONCAT('%',#{keyword},'%')
		</if>
		order by 
		<if test="sort == 'recommend'">
			content_num desc
		</if>
		<if test="sort == 'date'">
			release_date desc
		</if>
		<if test="sort == 'asc'">
			content_name 
		</if>
		<if test="sort == 'desc'">
			content_name desc
		</if>
		limit #{startRow}, #{rowBlockCount}
	</select>
	<select id="find" parameterType="int" resultType="content">
		select * from content where content_num=#{value}
	</select>
	<select id="count" resultType="int">
		select count(*) from content
	</select>
	<select id="listCount" resultType="int" parameterType="hashmap">
		select count(*) from content 
		<if test="keyword != null">
			where content_name like CONCAT('%',#{keyword},'%')
		</if>
	</select>
	<select id="maxNum" resultType="int">
		select max(content_num) from content
	</select>
</mapper>
  
